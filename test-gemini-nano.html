<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gemini Nano Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }

        .container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }

        .success {
            border-color: #4CAF50;
            background: #f8fff8;
        }

        .error {
            border-color: #f44336;
            background: #fff8f8;
        }

        .warning {
            border-color: #ff9800;
            background: #fff8f0;
        }

        button {
            background: #4285f4;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }

        button:hover {
            background: #3367d6;
        }

        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .log {
            background: #f8f8f8;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
        }

        .response {
            background: #e8f5e8;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            border-left: 4px solid #4CAF50;
        }

        .info {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
            border-left: 4px solid #2196F3;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>ü§ñ Gemini Nano Availability Test</h1>

        <div class="info">
            <h3>‚ÑπÔ∏è About Gemini Nano</h3>
            <p>Gemini Nano is Google's on-device AI model that runs locally in Chrome browsers. It provides real AI
                responses without internet connectivity.</p>
            <p><strong>Requirements:</strong> Chrome 127+ with "Prompt API for Gemini Nano" enabled in chrome://flags/
            </p>
        </div>

        <div id="availability" class="test-section">
            <h3>üìä Availability Check</h3>
            <p id="availabilityText">Checking...</p>
        </div>

        <div class="test-section">
            <h3>üß™ Tests</h3>
            <button onclick="checkAvailability()">Check Gemini Nano Availability</button>
            <button onclick="testInitialization()" id="initBtn" disabled>Test Initialization</button>
            <button onclick="testResponses()" id="testBtn" disabled>Test AI Responses</button>
            <button onclick="clearLog()">Clear Log</button>
        </div>

        <div class="test-section">
            <h3>üìù Test Log</h3>
            <div id="log" class="log"></div>
        </div>

        <div id="responses" class="test-section" style="display: none;">
            <h3>üí¨ AI Responses</h3>
            <div id="responseContainer"></div>
        </div>
    </div>

    <script>
        let aiSession = null;
        let capabilities = null;

        function log(message, type = 'info') {
            const logElement = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            const prefix = type === 'error' ? '‚ùå' : type === 'success' ? '‚úÖ' : type === 'warning' ? '‚ö†Ô∏è' : '‚ÑπÔ∏è';
            logElement.textContent += `[${timestamp}] ${prefix} ${message}\n`;
            logElement.scrollTop = logElement.scrollHeight;
        }

        function updateAvailability(text, className = '') {
            const availabilityElement = document.getElementById('availability');
            const availabilityText = document.getElementById('availabilityText');
            availabilityText.textContent = text;
            availabilityElement.className = `test-section ${className}`;
        }

        window.checkAvailability = async function () {
            log('Checking Gemini Nano availability...');

            try {
                // Check if the API exists
                if (!window.ai) {
                    updateAvailability('‚ùå window.ai not available - Gemini Nano not supported', 'error');
                    log('window.ai is not available', 'error');
                    log('This browser does not support Gemini Nano', 'error');
                    log('Try Chrome 127+ with "Prompt API for Gemini Nano" enabled in chrome://flags/', 'warning');
                    return;
                }

                if (!window.ai.languageModel) {
                    updateAvailability('‚ùå languageModel API not available', 'error');
                    log('window.ai.languageModel is not available', 'error');
                    log('Enable "Prompt API for Gemini Nano" in chrome://flags/', 'warning');
                    return;
                }

                log('window.ai.languageModel found, checking capabilities...', 'success');

                // Check capabilities
                capabilities = await window.ai.languageModel.capabilities();
                log(`Capabilities: ${JSON.stringify(capabilities, null, 2)}`);

                if (capabilities.available === 'no') {
                    updateAvailability('‚ùå Gemini Nano not available on this device', 'error');
                    log('Gemini Nano is not available on this device', 'error');
                    return;
                }

                if (capabilities.available === 'after-download') {
                    updateAvailability('‚ö†Ô∏è Gemini Nano available after download', 'warning');
                    log('Gemini Nano model needs to be downloaded first', 'warning');
                    log('The model will be downloaded when you first create a session', 'info');
                } else if (capabilities.available === 'readily') {
                    updateAvailability('‚úÖ Gemini Nano readily available!', 'success');
                    log('Gemini Nano is readily available!', 'success');
                }

                log(`Default temperature: ${capabilities.defaultTemperature}`, 'info');
                log(`Max topK: ${capabilities.maxTopK}`, 'info');

                document.getElementById('initBtn').disabled = false;

            } catch (error) {
                updateAvailability('‚ùå Error checking availability', 'error');
                log(`Error checking availability: ${error.message}`, 'error');
                log('Make sure you\'re using Chrome 127+ with Gemini Nano enabled', 'warning');
            }
        };

        window.testInitialization = async function () {
            const initBtn = document.getElementById('initBtn');
            const testBtn = document.getElementById('testBtn');

            initBtn.disabled = true;
            log('Testing Gemini Nano initialization...');

            try {
                const systemPrompt = `You are an AI assistant specialized in helping artisans and craftspeople with their business and creative needs. Provide practical, encouraging advice for Indian artisans.`;

                log('Creating AI session with system prompt...');
                aiSession = await window.ai.languageModel.create({
                    systemPrompt: systemPrompt,
                    temperature: 0.7,
                    topK: capabilities?.maxTopK || 3
                });

                log('AI session created successfully!', 'success');

                // Test the session
                log('Testing session with a simple prompt...');
                const testResponse = await aiSession.prompt('Hello, introduce yourself briefly.');

                log(`Test response: "${testResponse}"`, 'success');
                log('Gemini Nano initialization successful!', 'success');

                testBtn.disabled = false;

            } catch (error) {
                log(`Initialization failed: ${error.message}`, 'error');

                if (error.message.includes('download')) {
                    log('The model is being downloaded. This may take several minutes.', 'warning');
                    log('Please wait and try again later.', 'info');
                } else {
                    log('Initialization failed. Check browser compatibility.', 'error');
                }
            } finally {
                initBtn.disabled = false;
            }
        };

        window.testResponses = async function () {
            if (!aiSession) {
                log('AI session not available. Please initialize first.', 'error');
                return;
            }

            const testBtn = document.getElementById('testBtn');
            testBtn.disabled = true;

            const responsesDiv = document.getElementById('responses');
            const responseContainer = document.getElementById('responseContainer');
            responsesDiv.style.display = 'block';
            responseContainer.innerHTML = '';

            const testQueries = [
                'Hello, how can you help me with my craft business?',
                '‡§Æ‡•à‡§Ç ‡§è‡§ï ‡§ï‡§æ‡§∞‡•Ä‡§ó‡§∞ ‡§π‡•Ç‡§Å, ‡§Æ‡•Å‡§ù‡•á ‡§µ‡•ç‡§Ø‡§æ‡§™‡§æ‡§∞ ‡§Æ‡•á‡§Ç ‡§Æ‡§¶‡§¶ ‡§ö‡§æ‡§π‡§ø‡§è',
                'How should I price my handmade jewelry?',
                'What are the best online platforms to sell crafts in India?'
            ];

            log('Starting response tests...');

            for (let i = 0; i < testQueries.length; i++) {
                const query = testQueries[i];
                log(`Testing query ${i + 1}: "${query}"`);

                try {
                    const startTime = performance.now();
                    const response = await aiSession.prompt(query);
                    const endTime = performance.now();

                    const processingTime = Math.round(endTime - startTime);
                    log(`Response ${i + 1} (${processingTime}ms): "${response.substring(0, 100)}..."`, 'success');

                    const responseDiv = document.createElement('div');
                    responseDiv.className = 'response';
                    responseDiv.innerHTML = `
                        <strong>Query:</strong> ${query}<br>
                        <strong>Response:</strong> ${response}<br>
                        <small>Processing Time: ${processingTime}ms | Model: Gemini Nano</small>
                    `;
                    responseContainer.appendChild(responseDiv);

                } catch (error) {
                    log(`Response ${i + 1} failed: ${error.message}`, 'error');
                }
            }

            log('Response tests completed!', 'success');
            testBtn.disabled = false;
        };

        window.clearLog = function () {
            document.getElementById('log').textContent = '';
            document.getElementById('responseContainer').innerHTML = '';
            document.getElementById('responses').style.display = 'none';
        };

        // Auto-check availability on page load
        window.addEventListener('load', () => {
            log('Gemini Nano test page loaded');
            checkAvailability();
        });
    </script>
</body>

</html>